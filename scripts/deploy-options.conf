# 自动部署配置选项
# 用于控制部署行为的详细配置

# 基本配置
DOCKER_REGISTRY="crpi-p6joc7xl4atpiic8.cn-hangzhou.personal.cr.aliyuncs.com"
IMAGE_NAME="hanchanglin/tbk"
COMPOSE_FILE="docker-compose.production.yml"
HEALTH_CHECK_URL="http://localhost:3003/api/health"

# 部署策略配置
DEPLOYMENT_STRATEGY="smart"  # smart | force | schedule

# smart: 只在检测到新镜像时部署（推荐）
# force: 每次都强制重新部署
# schedule: 按计划部署

# 智能部署配置（当DEPLOYMENT_STRATEGY=smart时）
CHECK_IMAGE_CHANGES=true          # 是否检查镜像变化
CHECK_CONFIG_CHANGES=true         # 是否检查配置文件变化
CHECK_ENV_CHANGES=true            # 是否检查环境变量变化

# 强制部署配置（当DEPLOYMENT_STRATEGY=force时）
FORCE_RECREATE=true               # 是否强制重建容器
FORCE_PULL=true                   # 是否强制拉取镜像

# 计划部署配置（当DEPLOYMENT_STRATEGY=schedule时）
SCHEDULE_CRON="0 2 * * *"         # 每天凌晨2点部署
SCHEDULE_ENABLED=false            # 是否启用计划部署

# 安全配置
ENABLE_BACKUP=true                # 是否在部署前备份
ENABLE_ROLLBACK=true              # 是否在失败时自动回滚
MAX_ROLLBACK_ATTEMPTS=3           # 最大回滚尝试次数

# 健康检查配置
HEALTH_CHECK_TIMEOUT=300          # 健康检查超时时间（秒）
HEALTH_CHECK_INTERVAL=15          # 健康检查间隔（秒）
HEALTH_CHECK_RETRIES=10           # 健康检查重试次数

# 通知配置
ENABLE_NOTIFICATIONS=true         # 是否启用通知
NOTIFICATION_WEBHOOK=""           # 通知webhook地址
NOTIFICATION_EMAIL=""             # 通知邮箱地址

# 日志配置
LOG_LEVEL="INFO"                  # 日志级别: DEBUG | INFO | WARN | ERROR
LOG_RETENTION_DAYS=30             # 日志保留天数
LOG_MAX_SIZE="100M"               # 单个日志文件最大大小

# 性能配置
PARALLEL_DEPLOYMENT=false         # 是否并行部署多个服务
DEPLOYMENT_TIMEOUT=600            # 部署超时时间（秒）
GRACEFUL_SHUTDOWN_TIMEOUT=30      # 优雅关闭超时时间（秒）

# 高级配置
ENABLE_BLUE_GREEN=false           # 是否启用蓝绿部署
ENABLE_CANARY=false               # 是否启用金丝雀部署
CANARY_PERCENTAGE=10              # 金丝雀部署流量百分比

# 监控配置
ENABLE_METRICS=true               # 是否启用指标收集
METRICS_ENDPOINT="/metrics"       # 指标端点
ENABLE_TRACING=false              # 是否启用链路追踪

# 环境特定配置
ENVIRONMENT="production"          # 环境名称
CLUSTER_NAME="default"            # 集群名称
NAMESPACE="default"               # 命名空间

# 镜像管理配置
KEEP_OLD_IMAGES=3                 # 保留旧镜像数量
AUTO_CLEANUP=true                 # 是否自动清理
CLEANUP_SCHEDULE="0 3 * * 0"      # 清理计划（每周日凌晨3点）

# 安全扫描配置
ENABLE_SECURITY_SCAN=false        # 是否启用安全扫描
SECURITY_SCAN_TIMEOUT=300         # 安全扫描超时时间
FAIL_ON_SECURITY_ISSUES=false     # 是否在发现安全问题时失败

# 测试配置
ENABLE_SMOKE_TESTS=true           # 是否启用冒烟测试
SMOKE_TEST_TIMEOUT=120            # 冒烟测试超时时间
ENABLE_INTEGRATION_TESTS=false    # 是否启用集成测试

# 数据库配置
ENABLE_DB_MIGRATION=true          # 是否启用数据库迁移
DB_MIGRATION_TIMEOUT=300          # 数据库迁移超时时间
BACKUP_DB_BEFORE_MIGRATION=true   # 迁移前是否备份数据库