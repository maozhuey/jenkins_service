# æ¶æ„ä¿¡æ¯æ›´æ–°è®°å½•

## 2025-01-26 ç”Ÿäº§ç¯å¢ƒæ¶æ„æ›´æ–°

### æœåŠ¡å™¨ä¿¡æ¯
- **é˜¿é‡Œäº‘ECS IP**: 60.205.0.185 (å·²ç¡®è®¤ä¸ºæ­£ç¡®åœ°å€)
- **SSHè®¤è¯æ–¹å¼**: å¯†ç è®¤è¯ (ç”¨æˆ·å: root, å¯†ç : han0419/)
- **æ“ä½œç³»ç»Ÿ**: Linux (é˜¿é‡Œäº‘ECS)

### å®¹å™¨æ¶æ„
#### è¿è¡Œä¸­çš„å®¹å™¨
1. **tbk-production** (åº”ç”¨å®¹å™¨)
   - é•œåƒ: `crpi-p6joc7xl4atpiic8.cn-hangzhou.personal.cr.aliyuncs.com/hanchanglin/tbk:latest`
   - ç«¯å£æ˜ å°„: `3001:3000` (é¿å…ç«¯å£å†²çª)
   - ç½‘ç»œ: `tbk_tbk-production-network`
   - çŠ¶æ€: healthy
   - è®¿é—®åœ°å€: http://60.205.0.185:3001

2. **docker-mysql** (æ•°æ®åº“å®¹å™¨)
   - ç«¯å£: 3306
   - æ•°æ®åº“: peach_wiki
   - ç”¨æˆ·: root
   - å¯†ç : han0419/

3. **redis-manual** (ç¼“å­˜å®¹å™¨)
   - çŠ¶æ€: è¿è¡Œä¸­

### ç½‘ç»œé…ç½®
- **ä¸»ç½‘ç»œ**: `tbk_tbk-production-network`
- **å…¶ä»–ç½‘ç»œ**: `tbk-manual-net`, `bridge`, `host`, `none`

### éƒ¨ç½²ç›®å½•ç»“æ„
```
/opt/apps/tbk/
â”œâ”€â”€ aliyun-ecs-deploy.yml      # ç”Ÿäº§ç¯å¢ƒdocker-composeæ–‡ä»¶
â”œâ”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ (å·²ä¿®å¤)
â”œâ”€â”€ docker-compose.yml         # æœ¬åœ°ç¯å¢ƒé…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â””â”€â”€ src/
```

### é…ç½®æ–‡ä»¶çŠ¶æ€
#### .env.production (å·²ä¿®å¤)
```bash
NODE_ENV=production
PORT=3000
DB_HOST=docker-mysql          # å·²ä¿®å¤: ä»localhostæ”¹ä¸ºdocker-mysql
DB_PORT=3306
DB_USER=root
DB_PASSWORD=han0419/          # å·²ä¿®å¤: ä»å ä½ç¬¦æ”¹ä¸ºå®é™…å¯†ç 
DB_NAME=peach_wiki
DOCKER_IMAGE_TAG=latest
API_BASE_URL=http://localhost:3000
JWT_SECRET=your_jwt_secret_here
REDIS_HOST=redis-manual
REDIS_PORT=6379
LOG_LEVEL=info
```

### å¥åº·æ£€æŸ¥çŠ¶æ€
- **åº”ç”¨å¥åº·æ£€æŸ¥**: âœ… http://60.205.0.185:3001/health è¿”å› "OK"
- **APIæ¥å£æµ‹è¯•**: âœ… è¿”å›å®Œæ•´å¥åº·çŠ¶æ€JSON
- **æ•°æ®åº“è¿æ¥**: âœ… æˆåŠŸè¿æ¥åˆ°docker-mysql
- **å®¹å™¨çŠ¶æ€**: âœ… healthy

### Jenkinsé…ç½®
- **Jenkins URL**: http://localhost:8082
- **é¡¹ç›®åç§°**: tbk-pipeline
- **æ„å»ºçŠ¶æ€**: æ„å»ºæˆåŠŸï¼Œéƒ¨ç½²æ‰‹åŠ¨ä¿®å¤
- **é•œåƒä»“åº“**: é˜¿é‡Œäº‘ACR (crpi-p6joc7xl4atpiic8.cn-hangzhou.personal.cr.aliyuncs.com)

### å·²è§£å†³çš„é—®é¢˜
1. âœ… SSHè¿æ¥é…ç½® (IPåœ°å€å’Œè®¤è¯æ–¹å¼)
2. âœ… ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“é…ç½®
3. âœ… ç«¯å£å†²çªé—®é¢˜
4. âœ… å®¹å™¨å¯åŠ¨å¤±è´¥
5. âœ… åº”ç”¨å¥åº·æ£€æŸ¥

### å¾…ä¼˜åŒ–é¡¹ç›®
1. ğŸ”„ æ›´æ–°Jenkins pipelineä¸­çš„ECS_HOSTç¯å¢ƒå˜é‡
2. ğŸ”„ ä¿®å¤docker-compose.ymlè¯­æ³•é”™è¯¯
3. ğŸ”„ é…ç½®nginxåå‘ä»£ç† (80ç«¯å£ â†’ 3001ç«¯å£)
4. ğŸ”„ å»ºç«‹è‡ªåŠ¨åŒ–å¥åº·æ£€æŸ¥æœºåˆ¶
5. ğŸ”„ ä¼˜åŒ–éƒ¨ç½²æµç¨‹è‡ªåŠ¨åŒ–

### è®¿é—®ä¿¡æ¯
- **åº”ç”¨è®¿é—®**: http://60.205.0.185:3001
- **å¥åº·æ£€æŸ¥**: http://60.205.0.185:3001/health
- **æ•°æ®åº“**: 60.205.0.185:3306 (docker-mysqlå®¹å™¨)
- **Redis**: 60.205.0.185:6379 (redis-manualå®¹å™¨)

---
**æ›´æ–°æ—¶é—´**: 2025-01-26 17:04:20  
**æ›´æ–°äººå‘˜**: AIåŠ©æ‰‹  
**æ›´æ–°åŸå› **: ä¿®å¤Jenkinséƒ¨ç½²å¤±è´¥é—®é¢˜åçš„æ¶æ„çŠ¶æ€è®°å½•